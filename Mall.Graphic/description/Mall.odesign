<?xml version="1.0" encoding="UTF-8"?>
<description:Group xmi:version="2.0" xmlns:xmi="http://www.omg.org/XMI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:description="http://www.eclipse.org/sirius/description/1.1.0" xmlns:description_1="http://www.eclipse.org/sirius/diagram/description/1.1.0" xmlns:properties="http://www.eclipse.org/sirius/properties/1.0.0" xmlns:style="http://www.eclipse.org/sirius/diagram/description/style/1.1.0" xmlns:tool="http://www.eclipse.org/sirius/diagram/description/tool/1.1.0" xmlns:tool_1="http://www.eclipse.org/sirius/description/tool/1.1.0" xmlns:validation="http://www.eclipse.org/sirius/description/validation/1.1.0" name="Mall" version="12.0.0.2017041100">
  <ownedViewpoints name="Mall Viewpoint">
    <ownedRepresentations xsi:type="description_1:DiagramDescription" name="Mall Diagram" domainClass="MallDsm::Mall" enablePopupBars="true">
      <metamodel href="http://mall.com#/"/>
      <validationSet name="Validations">
        <ownedRules xsi:type="validation:SemanticValidationRule" name="UniqueCatNameRule" level="ERROR" message="Category name must be unique" targetClass="MallDsm::Category">
          <audits auditExpression="aql:self.eContainer().categories->forAll(c1|c1&lt;>self implies c1.name&lt;>self.name)"/>
        </ownedRules>
        <ownedRules xsi:type="validation:SemanticValidationRule" name="UniqueSubCatNameRule" level="ERROR" message="SubCategory name must be unique" targetClass="MallDsm::SubCategory">
          <audits auditExpression="aql:let subCats=self.eContainer().eContainer().categories.contains in subCats->forAll(s1|s1&lt;>self implies s1.name&lt;>self.name)"/>
        </ownedRules>
        <ownedRules xsi:type="validation:SemanticValidationRule" name="UniqueBrandNameRule" level="ERROR" message="Brand name must be unique" targetClass="MallDsm::Brand">
          <audits auditExpression="aql:let brands=self.eContainer().availableBrands in brands->forAll(b1|b1&lt;>self implies b1.name&lt;>self.name)"/>
        </ownedRules>
        <ownedRules xsi:type="validation:SemanticValidationRule" name="UniqueGoodNameRule" level="ERROR" message="Good name must be unique" targetClass="MallDsm::Good">
          <audits auditExpression="aql:let goods=self.eContainer().eContainer().availableBrands.producedGoods in goods->forAll(g1|g1&lt;>self implies g1.modelNumber&lt;>self.modelNumber)"/>
        </ownedRules>
        <ownedRules xsi:type="validation:SemanticValidationRule" name="UniqueShopNameRule" level="ERROR" message="Shop name must be unique" targetClass="MallDsm::Shop">
          <audits auditExpression="aql:let shops=self.eContainer().shops in shops->forAll(s1|s1&lt;>self implies s1.name&lt;>self.name)"/>
        </ownedRules>
        <ownedRules xsi:type="validation:SemanticValidationRule" name="NoDoubleListingRule" level="ERROR" message="The same good can't be listed twice in the same shop" targetClass="MallDsm::ListedGood">
          <audits auditExpression="aql:let listings=self.eContainer().soldGoods in listings->forAll(l1|l1&lt;>self implies l1.good&lt;>self.good)"/>
        </ownedRules>
        <ownedRules xsi:type="validation:SemanticValidationRule" name="PosPriceRule" level="ERROR" message="Price must be positive" targetClass="MallDsm::ListedGood">
          <audits auditExpression="[self.defaultPrice>0/]"/>
        </ownedRules>
        <ownedRules xsi:type="validation:SemanticValidationRule" name="ValidPercentageDiscountRule" level="ERROR" message="Sale Percentage must be between 0 and 100" targetClass="MallDsm::Discount">
          <audits auditExpression="[self.percentage&lt;=100 and self.percentage>=0/]"/>
        </ownedRules>
        <ownedRules xsi:type="validation:SemanticValidationRule" name="ShelfLayersRule" level="ERROR" message="A shelf must have at least a layer" targetClass="MallDsm::Shelf">
          <audits auditExpression="[self.layers>0/]"/>
        </ownedRules>
        <ownedRules xsi:type="validation:SemanticValidationRule" name="ValidInterval" level="ERROR" message="Shift can't start after ending" targetClass="MallDsm::TimeSpan">
          <audits auditExpression="aql:if(self.endDay=self.startDay) self.endHour>=self.startHour else true endif"/>
        </ownedRules>
        <ownedRules xsi:type="validation:SemanticValidationRule" name="ValidTimeSpan" level="ERROR" message="Days must be 0-6 and hours 0-23" targetClass="MallDsm::TimeSpan">
          <audits auditExpression="[self.startHour>=0 and self.startHour&lt;=23 and self.startDay>=0 and self.startDay&lt;=6 and self.endHour>=0 and self.endHour&lt;=23 and self.endDay>=0 and self.endDay&lt;=6/]"/>
        </ownedRules>
        <ownedRules xsi:type="validation:SemanticValidationRule" name="NoOverlappingShiftsRule" level="ERROR" message="Shifts in the same schedule can't overlap" targetClass="MallDsm::TimeSpan">
          <audits auditExpression="aql:let shifts=self.eContainer().shifts in shifts->forAll(s1|s1&lt;>self implies let startAbs1: Integer =(s1.startDay*24+s1.startHour) in let endAbs1: Integer =(s1.endDay*24+s1.endHour) in let startAbs2: Integer =(self.startDay*24+self.startHour) in let endAbs2: Integer =(self.endDay*24+self.endHour) in if(startAbs1>startAbs2) startAbs1>endAbs2 and (endAbs1&lt;startAbs1 implies endAbs1&lt;startAbs2) else startAbs1&lt;>startAbs2 endif)"/>
        </ownedRules>
        <ownedRules xsi:type="validation:SemanticValidationRule" name="SpecialisticShopConstraintRule" level="ERROR" message="['All goods from '+self.name+' must be from category '+self.speciality.name/]" targetClass="MallDsm::SpecialisticShop">
          <audits auditExpression="aql:self.soldGoods->forAll(l1| self.speciality.contains->includes(l1.good.hasSubCategory))"/>
        </ownedRules>
        <ownedRules xsi:type="validation:SemanticValidationRule" name="BrandShopConstraintRule" level="ERROR" message="['All goods from '+self.name+' must be from brand '+self.brand.name/]" targetClass="MallDsm::BrandShop">
          <audits auditExpression="aql:self.soldGoods->forAll(l1|self.brand.producedGoods->includes(l1.good) )"/>
        </ownedRules>
        <ownedRules xsi:type="validation:SemanticValidationRule" name="ItemInStockMustBeSoldRule" level="ERROR" message="['Good '+self.contains.modelNumber+' is in stock but is not listed'/]" targetClass="MallDsm::ItemInStock">
          <audits auditExpression="aql:self.eContainer().eContainer().soldGoods.good->includes(self.contains)"/>
        </ownedRules>
        <ownedRules xsi:type="validation:SemanticValidationRule" name="UniqueFeaturePerGoodRule" level="ERROR" message="The same feature is defined twice for this good" targetClass="MallDsm::Feature">
          <audits auditExpression="aql:let features=self.eContainer().features in features->forAll(f1|f1&lt;>self implies f1.name&lt;>self.name)"/>
        </ownedRules>
      </validationSet>
      <defaultLayer name="Default">
        <edgeMappings name="ShopBrandEdge" sourceMapping="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@containerMappings[name='Shop%20Node']" targetMapping="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@containerMappings[name='Brand%20Node']" targetFinderExpression="aql:self.oclAsType(MallDsm::BrandShop).brand">
          <style sizeComputationExpression="2">
            <strokeColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='gray']"/>
            <centerLabelStyleDescription>
              <labelColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
            </centerLabelStyleDescription>
          </style>
        </edgeMappings>
        <edgeMappings name="SpecialisticCategoryEdge" sourceMapping="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@containerMappings[name='Shop%20Node']" targetMapping="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@containerMappings[name='Category%20Node']" targetFinderExpression="aql:self.oclAsType(MallDsm::SpecialisticShop).speciality">
          <style sizeComputationExpression="2">
            <strokeColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='gray']"/>
            <centerLabelStyleDescription>
              <labelColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
            </centerLabelStyleDescription>
          </style>
        </edgeMappings>
        <edgeMappings name="GoodSubCategory Edge" sourceMapping="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@containerMappings[name='Brand%20Node']/@subContainerMappings[name='Good%20Node']" targetMapping="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@containerMappings[name='Category%20Node']/@subNodeMappings[name='SubCategory%20Node']" targetFinderExpression="feature:hasSubCategory">
          <style sizeComputationExpression="2">
            <strokeColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='gray']"/>
            <centerLabelStyleDescription>
              <labelColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
            </centerLabelStyleDescription>
          </style>
        </edgeMappings>
        <containerMappings name="Shop Node" domainClass="MallDsm::Shop">
          <subContainerMappings name="Container Node" semanticCandidatesExpression="feature:eAllContents" domainClass="MallDsm::Container">
            <subNodeMappings name="ItemInStock Node" semanticCandidatesExpression="feature:containedGood" domainClass="MallDsm::ItemInStock">
              <style xsi:type="style:EllipseNodeDescription" labelExpression="[self.contains.modelNumber +' '+ self.itemCount.toString()/]" labelPosition="node" resizeKind="NSEW">
                <borderColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
                <labelColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
                <color xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='gray']"/>
              </style>
            </subNodeMappings>
            <style xsi:type="style:FlatContainerStyleDescription" borderSizeComputationExpression="1" labelExpression="aql:if (self.eClass().name='Shelf')'Shelf '.concat(self.layers.toString())if(self.eClass().name='Table')'Table 'else'Refrigerator 'endif endif">
              <borderColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
              <labelColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
              <backgroundColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='white']"/>
              <foregroundColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='light_green']"/>
            </style>
          </subContainerMappings>
          <subContainerMappings name="ListedGood Node" deletionDescription="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@toolSections.1/@ownedTools[name='Remove%20Listing']" semanticCandidatesExpression="feature:eAllContents" domainClass="MallDsm::ListedGood">
            <subNodeMappings name="DiscountNode" semanticCandidatesExpression="feature:eAllContents" domainClass="MallDsm::Discount">
              <style xsi:type="style:EllipseNodeDescription" labelExpression="['Sale of '+self.percentage+'%'+' from '+self.timeStart+' to '+self.timeEnd/]" labelPosition="node" resizeKind="NSEW">
                <borderColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
                <labelColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
                <color xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='gray']"/>
              </style>
            </subNodeMappings>
            <style xsi:type="style:FlatContainerStyleDescription" borderSizeComputationExpression="1" labelExpression="[self.good.modelNumber+' sold at '+self.defaultPrice/]">
              <borderColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
              <labelColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
              <backgroundColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='white']"/>
              <foregroundColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='light_gray']"/>
            </style>
          </subContainerMappings>
          <subContainerMappings xsi:type="description_1:ContainerMappingImport" name="Shop Schedule Node" deletionDescription="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@toolSections.2/@ownedTools[name='NoScheduleDelete']" semanticCandidatesExpression="feature:openSchedule" domainClass="MallDsm::WeeklySchedule">
            <subNodeMappings name="TimeSpan Node" semanticCandidatesExpression="feature:shifts" domainClass="MallDsm::TimeSpan">
              <style xsi:type="style:SquareDescription" labelExpression="['From '+startDay+'d -  '+startHour+ 'h to '+endDay+ 'd - '+endHour+'h'/]" labelPosition="node" resizeKind="NSEW">
                <borderColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
                <labelColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
                <color xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='gray']"/>
              </style>
            </subNodeMappings>
            <style xsi:type="style:FlatContainerStyleDescription" borderSizeComputationExpression="1" labelExpression="Schedule">
              <borderColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
              <labelColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
              <backgroundColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='light_yellow']"/>
              <foregroundColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='light_gray']"/>
            </style>
          </subContainerMappings>
          <subContainerMappings name="Employee Node" deletionDescription="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@toolSections.1/@ownedTools[name='Employee%20deletion']" semanticCandidatesExpression="feature:eAllContents" domainClass="MallDsm::Employee">
            <subContainerMappings xsi:type="description_1:ContainerMappingImport" name="Employee Schedule Node" deletionDescription="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@toolSections.2/@ownedTools[name='NoScheduleDelete']" semanticCandidatesExpression="feature:shiftSchedule" domainClass="MallDsm::WeeklySchedule">
              <subNodeMappings name="TimeSpan Node" semanticCandidatesExpression="feature:shifts" domainClass="MallDsm::TimeSpan">
                <style xsi:type="style:SquareDescription" labelExpression="['From '+startDay+'d -  '+startHour+ 'h to '+endDay+ 'd - '+endHour+'h'/]" labelPosition="node" resizeKind="NSEW">
                  <borderColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
                  <labelColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
                  <color xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='gray']"/>
                </style>
              </subNodeMappings>
              <style xsi:type="style:FlatContainerStyleDescription" borderSizeComputationExpression="1" labelExpression="Employee Schedule">
                <borderColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
                <labelColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
                <backgroundColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='light_yellow']"/>
                <foregroundColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='light_gray']"/>
              </style>
            </subContainerMappings>
            <conditionnalStyles predicateExpression="aql:self.eContainer().manager&lt;>self">
              <style xsi:type="style:FlatContainerStyleDescription" borderSizeComputationExpression="1">
                <borderColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
                <labelColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
                <backgroundColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='white']"/>
                <foregroundColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='light_gray']"/>
              </style>
            </conditionnalStyles>
            <conditionnalStyles predicateExpression="aql:self.eContainer().manager=self">
              <style xsi:type="style:FlatContainerStyleDescription" borderSizeComputationExpression="1" labelExpression="aql:'Manager '+self.name">
                <borderColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
                <labelColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
                <backgroundColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='light_orange']"/>
                <foregroundColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='dark_orange']"/>
              </style>
            </conditionnalStyles>
          </subContainerMappings>
          <style xsi:type="style:FlatContainerStyleDescription" borderSizeComputationExpression="1" labelExpression="aql:if (self.eClass().name='SpecialisticShop')'Specialistic Shop '.concat(self.name)else'Brand Shop '.concat(self.name)endif">
            <borderColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
            <labelColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
            <backgroundColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='white']"/>
            <foregroundColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='light_gray']"/>
          </style>
        </containerMappings>
        <containerMappings name="Category Node" deletionDescription="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@toolSections.2/@ownedTools[name='Delete%20Sub%20and%20Category']" domainClass="MallDsm::Category">
          <subNodeMappings name="SubCategory Node" deletionDescription="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@toolSections.2/@ownedTools[name='Delete%20Sub%20and%20Category']" semanticCandidatesExpression="feature:contains" domainClass="MallDsm::SubCategory">
            <style xsi:type="style:SquareDescription" labelPosition="node" resizeKind="NSEW">
              <borderColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
              <labelColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
              <color xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='light_gray']"/>
            </style>
          </subNodeMappings>
          <style xsi:type="style:FlatContainerStyleDescription" borderSizeComputationExpression="1">
            <borderColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
            <labelColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
            <backgroundColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='white']"/>
            <foregroundColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='light_gray']"/>
          </style>
        </containerMappings>
        <containerMappings name="Brand Node" deletionDescription="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@toolSections.2/@ownedTools[name='Delete%20GoodorBrand']" domainClass="MallDsm::Brand">
          <subContainerMappings name="Good Node" deletionDescription="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@toolSections.2/@ownedTools[name='Delete%20GoodorBrand']" semanticCandidatesExpression="feature:producedGoods" domainClass="MallDsm::Good">
            <subNodeMappings name="Feature Node" semanticCandidatesExpression="feature:eAllContents" domainClass="MallDsm::Feature">
              <style xsi:type="style:DotDescription" labelExpression="[self.name+' '+self.value/]" labelPosition="node" resizeKind="NSEW">
                <borderColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
                <labelColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
                <backgroundColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='gray']"/>
              </style>
            </subNodeMappings>
            <style xsi:type="style:FlatContainerStyleDescription" borderSizeComputationExpression="1" labelExpression="feature:modelNumber">
              <borderColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
              <labelColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
              <backgroundColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='white']"/>
              <foregroundColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='dark_chocolate']"/>
            </style>
          </subContainerMappings>
          <style xsi:type="style:FlatContainerStyleDescription" borderSizeComputationExpression="1">
            <borderColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
            <labelColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='black']"/>
            <backgroundColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='white']"/>
            <foregroundColor xsi:type="description:SystemColor" href="environment:/viewpoint#//@systemColors/@entries[name='dark_yellow']"/>
          </style>
        </containerMappings>
        <toolSections name="New">
          <ownedTools xsi:type="tool:ContainerCreationDescription" name="New Specialistic Shop" containerMappings="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@containerMappings[name='Shop%20Node']">
            <variable name="container"/>
            <viewVariable name="containerView"/>
            <initialOperation>
              <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:container">
                <subModelOperations xsi:type="tool_1:CreateInstance" typeName="MallDsm::SpecialisticShop" referenceName="shops">
                  <subModelOperations xsi:type="tool_1:SetValue" featureName="name" valueExpression="aql:'new Shop'+container.shops->size()"/>
                  <subModelOperations xsi:type="tool_1:SetValue" featureName="address" valueExpression="No Address Present"/>
                  <subModelOperations xsi:type="properties:DialogModelOperation" titleExpression="Select Category">
                    <buttons labelExpression="Cancel" closeDialogOnClick="true" rollbackChangesOnClose="true">
                      <initialOperation>
                        <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="instance">
                          <subModelOperations xsi:type="tool_1:RemoveElement"/>
                        </firstModelOperations>
                      </initialOperation>
                    </buttons>
                    <buttons labelExpression="OK" default="true" closeDialogOnClick="true">
                      <initialOperation>
                        <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="aql:instance">
                          <subModelOperations xsi:type="tool_1:If" conditionExpression="aql:self.speciality=null">
                            <subModelOperations xsi:type="tool_1:RemoveElement"/>
                          </subModelOperations>
                        </firstModelOperations>
                      </initialOperation>
                    </buttons>
                    <page name="Default Page" labelExpression="Please Select a Category for the new Shop" semanticCandidateExpression="var:self" groups="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@toolSections.0/@ownedTools[name='New%20Specialistic%20Shop']/@initialOperation/@firstModelOperations/@subModelOperations.0/@subModelOperations.2/@groups.0"/>
                    <groups name="Default Group" labelExpression="Group" semanticCandidateExpression="var:self">
                      <controls xsi:type="properties:SelectDescription" name="Category" labelExpression="Category" valueExpression="aql:instance.speciality" candidatesExpression="aql:instance.eContainer().categories" candidateDisplayExpression="aql:candidate.name">
                        <initialOperation>
                          <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="aql:instance">
                            <subModelOperations xsi:type="tool_1:SetValue" featureName="speciality" valueExpression="var:newValue"/>
                          </firstModelOperations>
                        </initialOperation>
                      </controls>
                    </groups>
                  </subModelOperations>
                  <subModelOperations xsi:type="tool_1:CreateInstance" typeName="MallDsm::WeeklySchedule" referenceName="openSchedule" variableName="schedInstance"/>
                  <subModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:instance">
                    <subModelOperations xsi:type="tool_1:CreateInstance" typeName="MallDsm::Employee" referenceName="manager" variableName="man">
                      <subModelOperations xsi:type="tool_1:SetValue" featureName="name" valueExpression="Default Manager"/>
                      <subModelOperations xsi:type="tool_1:CreateInstance" typeName="MallDsm::WeeklySchedule" referenceName="shiftSchedule" variableName="aa"/>
                    </subModelOperations>
                  </subModelOperations>
                </subModelOperations>
              </firstModelOperations>
            </initialOperation>
          </ownedTools>
          <ownedTools xsi:type="tool:ContainerCreationDescription" name="New Brand" containerMappings="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@containerMappings[name='Brand%20Node']">
            <variable name="container"/>
            <viewVariable name="containerView"/>
            <initialOperation>
              <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:container">
                <subModelOperations xsi:type="tool_1:CreateInstance" typeName="MallDsm::Brand" referenceName="availableBrands">
                  <subModelOperations xsi:type="tool_1:SetValue" featureName="name" valueExpression="aql:'new Brand'+container.availableBrands->size()"/>
                </subModelOperations>
              </firstModelOperations>
            </initialOperation>
          </ownedTools>
          <ownedTools xsi:type="tool:ContainerCreationDescription" name="New Category" containerMappings="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@containerMappings[name='Category%20Node']">
            <variable name="container"/>
            <viewVariable name="containerView"/>
            <initialOperation>
              <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:container">
                <subModelOperations xsi:type="tool_1:CreateInstance" typeName="MallDsm::Category" referenceName="categories">
                  <subModelOperations xsi:type="tool_1:SetValue" featureName="name" valueExpression="aql:'new Category'+container.categories->size()"/>
                </subModelOperations>
              </firstModelOperations>
            </initialOperation>
          </ownedTools>
          <ownedTools xsi:type="tool:NodeCreationDescription" name="New SubCategory" nodeMappings="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@containerMappings[name='Category%20Node']/@subNodeMappings[name='SubCategory%20Node']">
            <variable name="container"/>
            <viewVariable name="containerView"/>
            <initialOperation>
              <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:container">
                <subModelOperations xsi:type="tool_1:CreateInstance" typeName="MallDsm::SubCategory" referenceName="contains">
                  <subModelOperations xsi:type="tool_1:SetValue" featureName="name" valueExpression="aql:'new SubCategory'"/>
                </subModelOperations>
              </firstModelOperations>
            </initialOperation>
          </ownedTools>
          <ownedTools xsi:type="tool:ContainerCreationDescription" name="New Brand Shop" containerMappings="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@containerMappings[name='Shop%20Node']">
            <variable name="container"/>
            <viewVariable name="containerView"/>
            <initialOperation>
              <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:container">
                <subModelOperations xsi:type="tool_1:CreateInstance" typeName="MallDsm::BrandShop" referenceName="shops">
                  <subModelOperations xsi:type="tool_1:SetValue" featureName="name" valueExpression="aql:'new Shop'+container.shops->size()"/>
                  <subModelOperations xsi:type="tool_1:SetValue" featureName="address" valueExpression="No Address Present"/>
                  <subModelOperations xsi:type="properties:DialogModelOperation" titleExpression="Select Brand">
                    <buttons labelExpression="Cancel" closeDialogOnClick="true" rollbackChangesOnClose="true">
                      <initialOperation>
                        <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="instance">
                          <subModelOperations xsi:type="tool_1:RemoveElement"/>
                        </firstModelOperations>
                      </initialOperation>
                    </buttons>
                    <buttons labelExpression="OK" default="true" closeDialogOnClick="true">
                      <initialOperation>
                        <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="aql:instance">
                          <subModelOperations xsi:type="tool_1:If" conditionExpression="aql:self.brand=null">
                            <subModelOperations xsi:type="tool_1:RemoveElement"/>
                          </subModelOperations>
                        </firstModelOperations>
                      </initialOperation>
                    </buttons>
                    <page name="Default Page" labelExpression="Please Select a Brand for the new Shop" semanticCandidateExpression="var:self" groups="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@toolSections.0/@ownedTools[name='New%20Brand%20Shop']/@initialOperation/@firstModelOperations/@subModelOperations.0/@subModelOperations.2/@groups.0"/>
                    <groups name="Default Group" labelExpression="Group" semanticCandidateExpression="var:self">
                      <controls xsi:type="properties:SelectDescription" name="Brand" labelExpression="Brand" valueExpression="aql:instance.brand" candidatesExpression="aql:instance.eContainer().availableBrands" candidateDisplayExpression="aql:candidate.name">
                        <initialOperation>
                          <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="aql:instance">
                            <subModelOperations xsi:type="tool_1:SetValue" featureName="brand" valueExpression="var:newValue"/>
                          </firstModelOperations>
                        </initialOperation>
                      </controls>
                    </groups>
                  </subModelOperations>
                  <subModelOperations xsi:type="tool_1:CreateInstance" typeName="MallDsm::WeeklySchedule" referenceName="openSchedule" variableName="schedInstance"/>
                  <subModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:instance">
                    <subModelOperations xsi:type="tool_1:CreateInstance" typeName="MallDsm::Employee" referenceName="manager" variableName="man">
                      <subModelOperations xsi:type="tool_1:SetValue" featureName="name" valueExpression="Default Manager"/>
                      <subModelOperations xsi:type="tool_1:CreateInstance" typeName="MallDsm::WeeklySchedule" referenceName="shiftSchedule" variableName="aa"/>
                    </subModelOperations>
                  </subModelOperations>
                </subModelOperations>
              </firstModelOperations>
            </initialOperation>
          </ownedTools>
          <ownedTools xsi:type="tool:ContainerCreationDescription" name="New Container" containerMappings="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@containerMappings[name='Shop%20Node']/@subContainerMappings[name='Container%20Node']">
            <variable name="container"/>
            <viewVariable name="containerView"/>
            <initialOperation>
              <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:container">
                <subModelOperations xsi:type="properties:DialogModelOperation" titleExpression="Container Dialog">
                  <buttons labelExpression="Cancel" closeDialogOnClick="true" rollbackChangesOnClose="true">
                    <initialOperation/>
                  </buttons>
                  <buttons labelExpression="OK" default="true" closeDialogOnClick="true">
                    <initialOperation/>
                  </buttons>
                  <page name="Container Page" labelExpression="Container Creation" semanticCandidateExpression="var:self" groups="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@toolSections.0/@ownedTools[name='New%20Container']/@initialOperation/@firstModelOperations/@subModelOperations.0/@groups.0"/>
                  <groups name="Default Group" labelExpression="Please select the type of the new container. Press create to create one or more of the selected types. The New Containers will appear after the window has been closed" semanticCandidateExpression="var:self">
                    <controls xsi:type="properties:ListDescription" name="ContainerList" labelExpression="Select Type" valueExpression="aql:Sequence{MallDsm::Shelf,MallDsm::Refrigerator,MallDsm::Table}" displayExpression="aql:value.name">
                      <onClickOperation/>
                      <actions labelExpression="Create">
                        <initialOperation>
                          <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:self">
                            <subModelOperations xsi:type="tool_1:Switch">
                              <cases conditionExpression="aql:selection->first()=MallDsm::Shelf">
                                <subModelOperations xsi:type="tool_1:CreateInstance" typeName="MallDsm::Shelf" referenceName="has">
                                  <subModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:instance">
                                    <subModelOperations xsi:type="tool_1:SetValue" featureName="layers" valueExpression="1"/>
                                  </subModelOperations>
                                </subModelOperations>
                              </cases>
                              <cases conditionExpression="aql:selection->first()=MallDsm::Refrigerator">
                                <subModelOperations xsi:type="tool_1:CreateInstance" typeName="MallDsm::Refrigerator" referenceName="has"/>
                              </cases>
                              <cases conditionExpression="aql:selection->first()=MallDsm::Table">
                                <subModelOperations xsi:type="tool_1:CreateInstance" typeName="MallDsm::Table" referenceName="has"/>
                              </cases>
                            </subModelOperations>
                          </firstModelOperations>
                        </initialOperation>
                      </actions>
                    </controls>
                  </groups>
                </subModelOperations>
              </firstModelOperations>
            </initialOperation>
          </ownedTools>
          <ownedTools xsi:type="tool:ContainerCreationDescription" name="New Employee" containerMappings="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@containerMappings[name='Shop%20Node']/@subContainerMappings[name='Employee%20Node']">
            <variable name="container"/>
            <viewVariable name="containerView"/>
            <initialOperation>
              <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:container">
                <subModelOperations xsi:type="tool_1:CreateInstance" typeName="MallDsm::Employee" referenceName="employees">
                  <subModelOperations xsi:type="tool_1:SetValue" featureName="name" valueExpression="aql:'New Employee '+(container.eContainer().shops.employees->size()+container.eContainer().shops.manager->size())"/>
                  <subModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:instance">
                    <subModelOperations xsi:type="tool_1:CreateInstance" typeName="MallDsm::WeeklySchedule" referenceName="shiftSchedule" variableName="schedule"/>
                  </subModelOperations>
                </subModelOperations>
              </firstModelOperations>
            </initialOperation>
          </ownedTools>
        </toolSections>
        <toolSections name="Shop">
          <ownedTools xsi:type="tool:EdgeCreationDescription" name="Set Shop Category" edgeMappings="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@edgeMappings[name='SpecialisticCategoryEdge']" connectionStartPrecondition="aql:preSource.oclAsType(MallDsm::SpecialisticShop)">
            <sourceVariable name="source"/>
            <targetVariable name="target"/>
            <sourceViewVariable name="sourceView"/>
            <targetViewVariable name="targetView"/>
            <initialOperation>
              <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:source">
                <subModelOperations xsi:type="properties:DialogModelOperation" titleExpression="New Dialog">
                  <buttons labelExpression="Cancel" closeDialogOnClick="true" rollbackChangesOnClose="true">
                    <initialOperation/>
                  </buttons>
                  <buttons labelExpression="OK" default="true" closeDialogOnClick="true">
                    <initialOperation>
                      <firstModelOperations xsi:type="tool_1:SetValue" featureName="speciality" valueExpression="var:target">
                        <subModelOperations xsi:type="tool_1:For" expression="aql:source.soldGoods">
                          <subModelOperations xsi:type="tool_1:If" conditionExpression="aql:not source.speciality.contains->includes(i.good.hasSubCategory)">
                            <subModelOperations xsi:type="tool_1:ChangeContext" browseExpression="i">
                              <subModelOperations xsi:type="tool_1:RemoveElement"/>
                            </subModelOperations>
                          </subModelOperations>
                        </subModelOperations>
                        <subModelOperations xsi:type="tool_1:For" expression="aql:source.has.containedGood">
                          <subModelOperations xsi:type="tool_1:If" conditionExpression="aql:not source.speciality.contains->includes(i.contains.hasSubCategory)">
                            <subModelOperations xsi:type="tool_1:ChangeContext" browseExpression="i">
                              <subModelOperations xsi:type="tool_1:RemoveElement"/>
                            </subModelOperations>
                          </subModelOperations>
                        </subModelOperations>
                      </firstModelOperations>
                    </initialOperation>
                  </buttons>
                  <page name="Default Page" semanticCandidateExpression="var:self" groups="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@toolSections.1/@ownedTools[name='Set%20Shop%20Category']/@initialOperation/@firstModelOperations/@subModelOperations.0/@groups.0" indented="true"/>
                  <groups name="Group" labelExpression="Warning, changing Speciality will remove from stock all invalid Goods, are you sure?"/>
                </subModelOperations>
              </firstModelOperations>
            </initialOperation>
          </ownedTools>
          <ownedTools xsi:type="tool:EdgeCreationDescription" name="Set Shop Brand" edgeMappings="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@edgeMappings[name='ShopBrandEdge']" connectionStartPrecondition="aql:preSource.oclAsType(MallDsm::BrandShop)">
            <sourceVariable name="source"/>
            <targetVariable name="target"/>
            <sourceViewVariable name="sourceView"/>
            <targetViewVariable name="targetView"/>
            <initialOperation>
              <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:source">
                <subModelOperations xsi:type="properties:DialogModelOperation" titleExpression="New Dialog">
                  <buttons labelExpression="Cancel" closeDialogOnClick="true" rollbackChangesOnClose="true">
                    <initialOperation/>
                  </buttons>
                  <buttons labelExpression="OK" default="true" closeDialogOnClick="true">
                    <initialOperation>
                      <firstModelOperations xsi:type="tool_1:SetValue" featureName="brand" valueExpression="var:target">
                        <subModelOperations xsi:type="tool_1:For" expression="aql:source.soldGoods">
                          <subModelOperations xsi:type="tool_1:If" conditionExpression="aql:not source.brand.producedGoods->includes(i.good)">
                            <subModelOperations xsi:type="tool_1:ChangeContext" browseExpression="i">
                              <subModelOperations xsi:type="tool_1:RemoveElement"/>
                            </subModelOperations>
                          </subModelOperations>
                        </subModelOperations>
                        <subModelOperations xsi:type="tool_1:For" expression="aql:source.has.containedGood">
                          <subModelOperations xsi:type="tool_1:If" conditionExpression="aql:not source.brand.producedGoods->includes(i.contains)">
                            <subModelOperations xsi:type="tool_1:ChangeContext" browseExpression="i">
                              <subModelOperations xsi:type="tool_1:RemoveElement"/>
                            </subModelOperations>
                          </subModelOperations>
                        </subModelOperations>
                      </firstModelOperations>
                    </initialOperation>
                  </buttons>
                  <page name="Default Page" semanticCandidateExpression="var:self" groups="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@toolSections.1/@ownedTools[name='Set%20Shop%20Brand']/@initialOperation/@firstModelOperations/@subModelOperations.0/@groups.0" indented="true"/>
                  <groups name="Group" labelExpression="Warning, changing Brand will remove from stock all invalid Goods, are you sure?"/>
                </subModelOperations>
              </firstModelOperations>
            </initialOperation>
          </ownedTools>
          <ownedTools xsi:type="tool:DeleteElementDescription" name="Remove Listing">
            <element name="element"/>
            <elementView name="elementView"/>
            <containerView name="containerView"/>
            <initialOperation>
              <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="aql:self.eContainer()">
                <subModelOperations xsi:type="properties:DialogModelOperation" titleExpression="New Dialog">
                  <buttons labelExpression="Cancel" closeDialogOnClick="true" rollbackChangesOnClose="true">
                    <initialOperation/>
                  </buttons>
                  <buttons labelExpression="OK" default="true" closeDialogOnClick="true">
                    <initialOperation>
                      <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:self">
                        <subModelOperations xsi:type="tool_1:For" expression="aql:self.has.containedGood">
                          <subModelOperations xsi:type="tool_1:If" conditionExpression="aql:i.contains=element.good">
                            <subModelOperations xsi:type="tool_1:ChangeContext" browseExpression="i">
                              <subModelOperations xsi:type="tool_1:RemoveElement"/>
                            </subModelOperations>
                          </subModelOperations>
                        </subModelOperations>
                        <subModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:element">
                          <subModelOperations xsi:type="tool_1:RemoveElement"/>
                        </subModelOperations>
                      </firstModelOperations>
                    </initialOperation>
                  </buttons>
                  <page name="Default Page" semanticCandidateExpression="var:self" groups="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@toolSections.1/@ownedTools[name='Remove%20Listing']/@initialOperation/@firstModelOperations/@subModelOperations.0/@groups.0" indented="true"/>
                  <groups name="Group" labelExpression="Warning, removing a listing will remove from stock all invalid Goods, are you sure?"/>
                </subModelOperations>
              </firstModelOperations>
            </initialOperation>
          </ownedTools>
          <ownedTools xsi:type="tool:ContainerCreationDescription" name="New Listing" containerMappings="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@containerMappings[name='Shop%20Node']/@subContainerMappings[name='ListedGood%20Node']">
            <variable name="container"/>
            <viewVariable name="containerView"/>
            <initialOperation>
              <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:container">
                <subModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:container">
                  <subModelOperations xsi:type="tool_1:Switch">
                    <cases conditionExpression="aql:container.oclAsType(MallDsm::BrandShop).brand.producedGoods->size()&lt;=container.soldGoods->size()">
                      <subModelOperations xsi:type="properties:DialogModelOperation" titleExpression="New Dialog">
                        <buttons labelExpression="Accept" closeDialogOnClick="true" rollbackChangesOnClose="true">
                          <initialOperation/>
                        </buttons>
                        <page name="No goods available" semanticCandidateExpression="var:self" groups="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@toolSections.1/@ownedTools[name='New%20Listing']/@initialOperation/@firstModelOperations/@subModelOperations.0/@subModelOperations.0/@cases.0/@subModelOperations.0/@groups.0"/>
                        <groups name="Default Group" labelExpression="There are no more goods that aren't listed from this brand, please edit those listings instead" semanticCandidateExpression="var:self"/>
                      </subModelOperations>
                    </cases>
                    <cases conditionExpression="aql:if(container.oclIsTypeOf(MallDsm::SpecialisticShop))let shop=container.oclAsType(MallDsm::SpecialisticShop) in shop.eContainer().availableBrands.producedGoods.hasSubCategory->select(s|shop.speciality.contains->includes(s))->size()&lt;=container.soldGoods->size() else false endif">
                      <subModelOperations xsi:type="properties:DialogModelOperation" titleExpression="New Dialog">
                        <buttons labelExpression="Accept" closeDialogOnClick="true" rollbackChangesOnClose="true">
                          <initialOperation/>
                        </buttons>
                        <page name="No goods available" semanticCandidateExpression="var:self" groups="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@toolSections.1/@ownedTools[name='New%20Listing']/@initialOperation/@firstModelOperations/@subModelOperations.0/@subModelOperations.0/@cases.1/@subModelOperations.0/@groups.0"/>
                        <groups name="Default Group" labelExpression="There are no more goods that aren't listed from this category, please edit those listings instead" semanticCandidateExpression="var:self"/>
                      </subModelOperations>
                    </cases>
                    <default>
                      <subModelOperations xsi:type="tool_1:CreateInstance" typeName="MallDsm::ListedGood" referenceName="soldGoods">
                        <subModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:instance">
                          <subModelOperations xsi:type="tool_1:SetValue" featureName="defaultPrice" valueExpression="1">
                            <subModelOperations xsi:type="tool_1:Switch">
                              <cases conditionExpression="aql:container.oclAsType(MallDsm::BrandShop)">
                                <subModelOperations xsi:type="tool_1:SetValue" featureName="good" valueExpression="aql:container.brand.producedGoods->select(g| not container.soldGoods.good->includes(g))->first()">
                                  <subModelOperations xsi:type="properties:DialogModelOperation" titleExpression="Good Selection">
                                    <buttons labelExpression="Cancel" closeDialogOnClick="true" rollbackChangesOnClose="true">
                                      <initialOperation/>
                                    </buttons>
                                    <buttons labelExpression="OK" default="true" closeDialogOnClick="true">
                                      <initialOperation/>
                                    </buttons>
                                    <page name="Default Page" labelExpression="Select Good" semanticCandidateExpression="var:self" groups="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@toolSections.1/@ownedTools[name='New%20Listing']/@initialOperation/@firstModelOperations/@subModelOperations.0/@subModelOperations.0/@default/@subModelOperations.0/@subModelOperations.0/@subModelOperations.0/@subModelOperations.0/@cases.0/@subModelOperations.0/@subModelOperations.0/@groups.0"/>
                                    <groups name="Default Group" labelExpression="Select Good" semanticCandidateExpression="var:self">
                                      <controls xsi:type="properties:SelectDescription" name="Select Good" labelExpression="Select Good" valueExpression="aql:instance.good" candidatesExpression="aql:container.brand.producedGoods->select(g| (not container.soldGoods.good->includes(g)) or g=instance.good)" candidateDisplayExpression="aql:candidate.modelNumber">
                                        <initialOperation>
                                          <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:instance">
                                            <subModelOperations xsi:type="tool_1:SetValue" featureName="good" valueExpression="var:newValue"/>
                                          </firstModelOperations>
                                        </initialOperation>
                                      </controls>
                                    </groups>
                                  </subModelOperations>
                                </subModelOperations>
                              </cases>
                              <cases conditionExpression="aql:container.oclAsType(MallDsm::SpecialisticShop)">
                                <subModelOperations xsi:type="tool_1:SetValue" featureName="good" valueExpression="aql:container.eContainer().availableBrands.producedGoods->select(g| container.speciality.contains->includes(g.hasSubCategory))->select(g| not container.soldGoods.good->includes(g))->first()">
                                  <subModelOperations xsi:type="properties:DialogModelOperation" titleExpression="Good Selection">
                                    <buttons labelExpression="Cancel" closeDialogOnClick="true" rollbackChangesOnClose="true">
                                      <initialOperation/>
                                    </buttons>
                                    <buttons labelExpression="OK" default="true" closeDialogOnClick="true">
                                      <initialOperation/>
                                    </buttons>
                                    <page name="Default Page" labelExpression="Select Good" semanticCandidateExpression="var:self" groups="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@toolSections.1/@ownedTools[name='New%20Listing']/@initialOperation/@firstModelOperations/@subModelOperations.0/@subModelOperations.0/@default/@subModelOperations.0/@subModelOperations.0/@subModelOperations.0/@subModelOperations.0/@cases.1/@subModelOperations.0/@subModelOperations.0/@groups.0"/>
                                    <groups name="Default Group" labelExpression="Select Good" semanticCandidateExpression="var:self">
                                      <controls xsi:type="properties:SelectDescription" name="Select Good" labelExpression="Select Good" valueExpression="aql:instance.good" candidatesExpression="aql:container.eContainer().availableBrands.producedGoods->select(g| container.speciality.contains->includes(g.hasSubCategory))->select(g| (not container.soldGoods.good->includes(g)) or g=instance.good)" candidateDisplayExpression="aql:candidate.modelNumber">
                                        <initialOperation>
                                          <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:instance">
                                            <subModelOperations xsi:type="tool_1:SetValue" featureName="good" valueExpression="var:newValue"/>
                                          </firstModelOperations>
                                        </initialOperation>
                                      </controls>
                                    </groups>
                                  </subModelOperations>
                                </subModelOperations>
                              </cases>
                            </subModelOperations>
                          </subModelOperations>
                        </subModelOperations>
                      </subModelOperations>
                    </default>
                  </subModelOperations>
                </subModelOperations>
              </firstModelOperations>
            </initialOperation>
          </ownedTools>
          <ownedTools xsi:type="tool_1:ToolDescription" name="Select Manager" precondition="aql:element.oclIsKindOf(MallDsm::Employee)">
            <element name="element"/>
            <elementView name="elementView"/>
            <initialOperation>
              <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="aql:element.eContainer()">
                <subModelOperations xsi:type="tool_1:If" conditionExpression="aql:element.eContainer().manager&lt;>element">
                  <subModelOperations xsi:type="tool_1:SetValue" featureName="employees" valueExpression="aql:element.eContainer().manager">
                    <subModelOperations xsi:type="tool_1:SetValue" featureName="manager" valueExpression="var:element"/>
                  </subModelOperations>
                </subModelOperations>
              </firstModelOperations>
            </initialOperation>
          </ownedTools>
          <ownedTools xsi:type="tool:NodeCreationDescription" name="New Sale" nodeMappings="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@containerMappings[name='Shop%20Node']/@subContainerMappings[name='ListedGood%20Node']/@subNodeMappings[name='DiscountNode']">
            <variable name="container"/>
            <viewVariable name="containerView"/>
            <initialOperation>
              <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:container">
                <subModelOperations xsi:type="tool_1:CreateInstance" typeName="MallDsm::Discount" referenceName="sales">
                  <subModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:instance">
                    <subModelOperations xsi:type="tool_1:SetValue" featureName="timeStart" valueExpression="1900-01-01">
                      <subModelOperations xsi:type="tool_1:SetValue" featureName="timeEnd" valueExpression="2100-01-01">
                        <subModelOperations xsi:type="tool_1:SetValue" featureName="percentage" valueExpression="0"/>
                      </subModelOperations>
                    </subModelOperations>
                  </subModelOperations>
                </subModelOperations>
              </firstModelOperations>
            </initialOperation>
          </ownedTools>
          <ownedTools xsi:type="tool:NodeCreationDescription" name="Add Shift" nodeMappings="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@containerMappings[name='Shop%20Node']/@subContainerMappings[name='Shop%20Schedule%20Node']/@subNodeMappings[name='TimeSpan%20Node'] //@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@containerMappings[name='Shop%20Node']/@subContainerMappings[name='Employee%20Node']/@subContainerMappings[name='Employee%20Schedule%20Node']/@subNodeMappings[name='TimeSpan%20Node']">
            <variable name="container"/>
            <viewVariable name="containerView"/>
            <initialOperation>
              <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:container">
                <subModelOperations xsi:type="tool_1:CreateInstance" typeName="MallDsm::TimeSpan" referenceName="shifts">
                  <subModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:instance">
                    <subModelOperations xsi:type="tool_1:SetValue" featureName="startHour" valueExpression="0">
                      <subModelOperations xsi:type="tool_1:SetValue" featureName="endHour" valueExpression="1">
                        <subModelOperations xsi:type="tool_1:SetValue" featureName="startDay" valueExpression="0">
                          <subModelOperations xsi:type="tool_1:SetValue" featureName="endDay" valueExpression="1"/>
                        </subModelOperations>
                      </subModelOperations>
                    </subModelOperations>
                  </subModelOperations>
                </subModelOperations>
              </firstModelOperations>
            </initialOperation>
          </ownedTools>
          <ownedTools xsi:type="tool:DeleteElementDescription" name="Employee deletion">
            <element name="element"/>
            <elementView name="elementView"/>
            <containerView name="containerView"/>
            <initialOperation>
              <firstModelOperations xsi:type="tool_1:Switch">
                <cases conditionExpression="aql:element.eContainer().manager=element">
                  <subModelOperations xsi:type="properties:DialogModelOperation" titleExpression="Error">
                    <buttons labelExpression="Accept" default="true" closeDialogOnClick="true">
                      <initialOperation/>
                    </buttons>
                    <page name="Default Page" semanticCandidateExpression="var:self" groups="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@toolSections.1/@ownedTools[name='Employee%20deletion']/@initialOperation/@firstModelOperations/@cases.0/@subModelOperations.0/@groups.0"/>
                    <groups name="Default Group" labelExpression="Please change the manager of the shop before firing him." semanticCandidateExpression="var:self"/>
                  </subModelOperations>
                </cases>
                <default>
                  <subModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:element">
                    <subModelOperations xsi:type="tool_1:RemoveElement"/>
                  </subModelOperations>
                </default>
              </firstModelOperations>
            </initialOperation>
          </ownedTools>
        </toolSections>
        <toolSections name="Good">
          <ownedTools xsi:type="tool:ContainerCreationDescription" name="New Good" containerMappings="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@containerMappings[name='Brand%20Node']/@subContainerMappings[name='Good%20Node']">
            <variable name="container"/>
            <viewVariable name="containerView"/>
            <initialOperation>
              <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:container">
                <subModelOperations xsi:type="tool_1:CreateInstance" typeName="MallDsm::Good" referenceName="producedGoods">
                  <subModelOperations xsi:type="tool_1:SetValue" featureName="modelNumber" valueExpression="New Good">
                    <subModelOperations xsi:type="properties:DialogModelOperation" titleExpression="Select SubCategory">
                      <buttons labelExpression="Cancel" closeDialogOnClick="true" rollbackChangesOnClose="true">
                        <initialOperation>
                          <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="instance">
                            <subModelOperations xsi:type="tool_1:RemoveElement"/>
                          </firstModelOperations>
                        </initialOperation>
                      </buttons>
                      <buttons labelExpression="OK" default="true" closeDialogOnClick="true">
                        <initialOperation>
                          <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="aql:instance">
                            <subModelOperations xsi:type="tool_1:If" conditionExpression="aql:self.hasSubCategory=null">
                              <subModelOperations xsi:type="tool_1:RemoveElement"/>
                            </subModelOperations>
                          </firstModelOperations>
                        </initialOperation>
                      </buttons>
                      <page name="Default Page" labelExpression="Please Select a SubCategory for the new Good" semanticCandidateExpression="var:self" groups="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@toolSections.2/@ownedTools[name='New%20Good']/@initialOperation/@firstModelOperations/@subModelOperations.0/@subModelOperations.0/@subModelOperations.0/@groups.0"/>
                      <groups name="Default Group" labelExpression="Group" semanticCandidateExpression="var:self">
                        <controls xsi:type="properties:SelectDescription" name="SubCategory" labelExpression="Sub Category" valueExpression="aql:instance.hasSubCategory" candidatesExpression="aql:instance.eContainer().eContainer().categories.contains" candidateDisplayExpression="aql:candidate.name">
                          <initialOperation>
                            <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="aql:instance">
                              <subModelOperations xsi:type="tool_1:SetValue" featureName="hasSubCategory" valueExpression="var:newValue"/>
                            </firstModelOperations>
                          </initialOperation>
                        </controls>
                      </groups>
                    </subModelOperations>
                  </subModelOperations>
                </subModelOperations>
              </firstModelOperations>
            </initialOperation>
          </ownedTools>
          <ownedTools xsi:type="tool:NodeCreationDescription" name="New ItemInStock" nodeMappings="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@containerMappings[name='Shop%20Node']/@subContainerMappings[name='Container%20Node']/@subNodeMappings[name='ItemInStock%20Node']">
            <variable name="container"/>
            <viewVariable name="containerView"/>
            <initialOperation>
              <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:container">
                <subModelOperations xsi:type="tool_1:If" conditionExpression="aql:container.eContainer().soldGoods.good->size()>0">
                  <subModelOperations xsi:type="tool_1:CreateInstance" typeName="MallDsm::ItemInStock" referenceName="containedGood">
                    <subModelOperations xsi:type="tool_1:ChangeContext" browseExpression="aql:instance">
                      <subModelOperations xsi:type="tool_1:SetValue" featureName="contains" valueExpression="aql:container.eContainer().soldGoods.good->first()"/>
                      <subModelOperations xsi:type="tool_1:SetValue" featureName="itemCount" valueExpression="1"/>
                    </subModelOperations>
                  </subModelOperations>
                  <subModelOperations xsi:type="properties:DialogModelOperation" titleExpression="New Dialog">
                    <buttons labelExpression="Cancel" closeDialogOnClick="true" rollbackChangesOnClose="true">
                      <initialOperation/>
                    </buttons>
                    <buttons labelExpression="OK" default="true" closeDialogOnClick="true">
                      <initialOperation/>
                    </buttons>
                    <page name="Insert new Item" labelExpression="New Item" semanticCandidateExpression="var:self" groups="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@toolSections.2/@ownedTools[name='New%20ItemInStock']/@initialOperation/@firstModelOperations/@subModelOperations.0/@subModelOperations.1/@groups.0"/>
                    <groups name="Default Group" labelExpression="Please select good type" semanticCandidateExpression="var:self">
                      <controls xsi:type="properties:SelectDescription" name="Select Good" labelExpression="Select Good:" valueExpression="aql:instance.contains" candidatesExpression="aql:self.eContainer().soldGoods.good" candidateDisplayExpression="aql:candidate.modelNumber">
                        <initialOperation>
                          <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="aql:instance">
                            <subModelOperations xsi:type="tool_1:SetValue" featureName="contains" valueExpression="aql:newValue"/>
                          </firstModelOperations>
                        </initialOperation>
                      </controls>
                    </groups>
                  </subModelOperations>
                </subModelOperations>
                <subModelOperations xsi:type="tool_1:If" conditionExpression="aql:container.eContainer().soldGoods.good->size()=0">
                  <subModelOperations xsi:type="properties:DialogModelOperation" titleExpression="Error">
                    <buttons labelExpression="Accept" closeDialogOnClick="true" rollbackChangesOnClose="true">
                      <initialOperation/>
                    </buttons>
                    <page name="Default Page" semanticCandidateExpression="var:self" groups="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@toolSections.2/@ownedTools[name='New%20ItemInStock']/@initialOperation/@firstModelOperations/@subModelOperations.1/@subModelOperations.0/@groups.0"/>
                    <groups name="Default Group" labelExpression="Selected Shop has no valid Goods. Please add listings first" semanticCandidateExpression="var:self"/>
                  </subModelOperations>
                </subModelOperations>
              </firstModelOperations>
            </initialOperation>
          </ownedTools>
          <ownedTools xsi:type="tool:EdgeCreationDescription" name="Set Good SubCategory" edgeMappings="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@edgeMappings[name='GoodSubCategory%20Edge']">
            <sourceVariable name="source"/>
            <targetVariable name="target"/>
            <sourceViewVariable name="sourceView"/>
            <targetViewVariable name="targetView"/>
            <initialOperation>
              <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:source">
                <subModelOperations xsi:type="properties:DialogModelOperation" titleExpression="New Dialog">
                  <buttons labelExpression="Cancel" closeDialogOnClick="true" rollbackChangesOnClose="true">
                    <initialOperation/>
                  </buttons>
                  <buttons labelExpression="OK" default="true" closeDialogOnClick="true">
                    <initialOperation>
                      <firstModelOperations xsi:type="tool_1:SetValue" featureName="hasSubCategory" valueExpression="var:target">
                        <subModelOperations xsi:type="tool_1:For" expression="aql:source.eContainer().eContainer().shops->filter(MallDsm::SpecialisticShop).soldGoods->select(lg|lg.good=source)">
                          <subModelOperations xsi:type="tool_1:If" conditionExpression="aql:not i.eContainer().speciality.contains->includes(source.hasSubCategory)">
                            <subModelOperations xsi:type="tool_1:For" expression="aql:i.eContainer().has" iteratorName="j">
                              <subModelOperations xsi:type="tool_1:For" expression="aql:j.containedGood->select(is|is.contains=source)" iteratorName="iStock">
                                <subModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:iStock">
                                  <subModelOperations xsi:type="tool_1:RemoveElement"/>
                                </subModelOperations>
                              </subModelOperations>
                            </subModelOperations>
                            <subModelOperations xsi:type="tool_1:ChangeContext" browseExpression="i">
                              <subModelOperations xsi:type="tool_1:RemoveElement"/>
                            </subModelOperations>
                          </subModelOperations>
                        </subModelOperations>
                      </firstModelOperations>
                    </initialOperation>
                  </buttons>
                  <page name="Default Page" semanticCandidateExpression="var:self" groups="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@toolSections.2/@ownedTools[name='Set%20Good%20SubCategory']/@initialOperation/@firstModelOperations/@subModelOperations.0/@groups.0" indented="true"/>
                  <groups name="Group" labelExpression="Warning, changing SubCategory will remove from Specialistic Shops all invalid Goods, are you sure?"/>
                </subModelOperations>
              </firstModelOperations>
            </initialOperation>
          </ownedTools>
          <ownedTools xsi:type="tool:NodeCreationDescription" name="New Feature" nodeMappings="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@containerMappings[name='Brand%20Node']/@subContainerMappings[name='Good%20Node']/@subNodeMappings[name='Feature%20Node']">
            <variable name="container"/>
            <viewVariable name="containerView"/>
            <initialOperation>
              <firstModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:container">
                <subModelOperations xsi:type="tool_1:CreateInstance" typeName="MallDsm::Feature" referenceName="features">
                  <subModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:instance">
                    <subModelOperations xsi:type="tool_1:SetValue" featureName="name" valueExpression="aql:'new Feature '+container.features->size()">
                      <subModelOperations xsi:type="tool_1:SetValue" featureName="value" valueExpression="NaN"/>
                    </subModelOperations>
                  </subModelOperations>
                </subModelOperations>
              </firstModelOperations>
            </initialOperation>
          </ownedTools>
          <ownedTools xsi:type="tool:DeleteElementDescription" name="Delete GoodorBrand">
            <element name="element"/>
            <elementView name="elementView"/>
            <containerView name="containerView"/>
            <initialOperation>
              <firstModelOperations xsi:type="properties:DialogModelOperation" titleExpression="Confirmation">
                <buttons labelExpression="Cancel" closeDialogOnClick="true" rollbackChangesOnClose="true">
                  <initialOperation/>
                </buttons>
                <buttons labelExpression="OK" default="true" closeDialogOnClick="true">
                  <initialOperation>
                    <firstModelOperations xsi:type="tool_1:Switch">
                      <cases conditionExpression="aql:element.oclIsKindOf(MallDsm::Brand)">
                        <subModelOperations xsi:type="tool_1:For" expression="aql:element.producedGoods" iteratorName="iG">
                          <subModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:iG">
                            <subModelOperations xsi:type="tool_1:For" expression="aql:iG.eContainer().eContainer().shops.soldGoods->select(l | l.good=iG)">
                              <subModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:i">
                                <subModelOperations xsi:type="tool_1:RemoveElement"/>
                              </subModelOperations>
                            </subModelOperations>
                            <subModelOperations xsi:type="tool_1:For" expression="aql:iG.eContainer().eContainer().shops.has.containedGood->select(is | is.contains=iG)">
                              <subModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:i">
                                <subModelOperations xsi:type="tool_1:RemoveElement"/>
                              </subModelOperations>
                            </subModelOperations>
                            <subModelOperations xsi:type="tool_1:RemoveElement"/>
                          </subModelOperations>
                        </subModelOperations>
                        <subModelOperations xsi:type="tool_1:Switch">
                          <cases conditionExpression="aql:element.eContainer().shops->select(s| s.oclIsKindOf(MallDsm::BrandShop) and s.brand=element)->size()>0">
                            <subModelOperations xsi:type="properties:DialogModelOperation" titleExpression="Notice">
                              <buttons labelExpression="Accept" default="true" closeDialogOnClick="true">
                                <initialOperation/>
                              </buttons>
                              <page name="Default Page" semanticCandidateExpression="var:self" groups="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@toolSections.2/@ownedTools[name='Delete%20GoodorBrand']/@initialOperation/@firstModelOperations/@groups.2"/>
                            </subModelOperations>
                          </cases>
                          <default>
                            <subModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:element">
                              <subModelOperations xsi:type="tool_1:RemoveElement"/>
                            </subModelOperations>
                          </default>
                        </subModelOperations>
                      </cases>
                      <default>
                        <subModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:element">
                          <subModelOperations xsi:type="tool_1:For" expression="aql:element.eContainer().eContainer().shops.soldGoods->select(l | l.good=element)">
                            <subModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:i">
                              <subModelOperations xsi:type="tool_1:RemoveElement"/>
                            </subModelOperations>
                          </subModelOperations>
                          <subModelOperations xsi:type="tool_1:For" expression="aql:element.eContainer().eContainer().shops.has.containedGood->select(is | is.contains=element)">
                            <subModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:i">
                              <subModelOperations xsi:type="tool_1:RemoveElement"/>
                            </subModelOperations>
                          </subModelOperations>
                          <subModelOperations xsi:type="tool_1:RemoveElement"/>
                        </subModelOperations>
                      </default>
                    </firstModelOperations>
                  </initialOperation>
                </buttons>
                <page name="Default Page" semanticCandidateExpression="var:self" groups="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@toolSections.2/@ownedTools[name='Delete%20GoodorBrand']/@initialOperation/@firstModelOperations/@groups.0 //@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@toolSections.2/@ownedTools[name='Delete%20GoodorBrand']/@initialOperation/@firstModelOperations/@groups.1"/>
                <groups name="Good Group" labelExpression="Warning: Removing a good will delete it from stock items and listings too, are you sure?" semanticCandidateExpression="var:self" preconditionExpression="aql:element.oclIsKindOf(MallDsm::Good)"/>
                <groups name="Brand Group" labelExpression="Warning: Removing a brand will delete contained goods from stock items and listings too, are you sure?" semanticCandidateExpression="var:self" preconditionExpression="aql:element.oclIsKindOf(MallDsm::Brand)"/>
                <groups name="NoDelete Brand" labelExpression="The Brand cannot be fully deleted while it is still referenced by some shops. Please change their brands first." semanticCandidateExpression="var:self"/>
              </firstModelOperations>
            </initialOperation>
          </ownedTools>
          <ownedTools xsi:type="tool:DeleteElementDescription" name="NoScheduleDelete">
            <element name="element"/>
            <elementView name="elementView"/>
            <containerView name="containerView"/>
            <initialOperation/>
          </ownedTools>
          <ownedTools xsi:type="tool:DeleteElementDescription" name="Delete Sub and Category">
            <element name="element"/>
            <elementView name="elementView"/>
            <containerView name="containerView"/>
            <initialOperation>
              <firstModelOperations xsi:type="tool_1:ChangeContext">
                <subModelOperations xsi:type="tool_1:Switch">
                  <cases conditionExpression="aql:element.oclIsTypeOf(MallDsm::Category)">
                    <subModelOperations xsi:type="tool_1:Switch">
                      <cases conditionExpression="aql:element.eContainer().shops->select(s|s.oclIsKindOf(MallDsm::SpecialisticShop) and s.speciality=element)->size()>0">
                        <subModelOperations xsi:type="properties:DialogModelOperation" titleExpression="Error">
                          <buttons labelExpression="Accept" default="true" closeDialogOnClick="true">
                            <initialOperation/>
                          </buttons>
                          <page name="Default Page" semanticCandidateExpression="var:self" groups="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@toolSections.2/@ownedTools[name='Delete%20Sub%20and%20Category']/@initialOperation/@firstModelOperations/@subModelOperations.0/@cases.0/@subModelOperations.0/@cases.0/@subModelOperations.0/@groups.0"/>
                          <groups name="Default Group" labelExpression="There are still specialistic shops referencing this category, please change their speciality before removing." semanticCandidateExpression="var:self"/>
                        </subModelOperations>
                      </cases>
                      <cases conditionExpression="aql:element.eContainer().availableBrands.producedGoods->select(g| element.contains->includes(g.hasSubCategory))->size()>0">
                        <subModelOperations xsi:type="properties:DialogModelOperation" titleExpression="Error">
                          <buttons labelExpression="Accept" default="true" closeDialogOnClick="true">
                            <initialOperation/>
                          </buttons>
                          <page name="Default Page" semanticCandidateExpression="var:self" groups="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@toolSections.2/@ownedTools[name='Delete%20Sub%20and%20Category']/@initialOperation/@firstModelOperations/@subModelOperations.0/@cases.0/@subModelOperations.0/@cases.1/@subModelOperations.0/@groups.0"/>
                          <groups name="Default Group" labelExpression="Some subcategories are still being referenced from goods. Please change those references before deleting this category and subcategories." semanticCandidateExpression="var:self"/>
                        </subModelOperations>
                      </cases>
                      <default>
                        <subModelOperations xsi:type="tool_1:For" expression="var:element.contains">
                          <subModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:i">
                            <subModelOperations xsi:type="tool_1:RemoveElement"/>
                          </subModelOperations>
                        </subModelOperations>
                        <subModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:element">
                          <subModelOperations xsi:type="tool_1:RemoveElement"/>
                        </subModelOperations>
                      </default>
                    </subModelOperations>
                  </cases>
                  <default>
                    <subModelOperations xsi:type="tool_1:Switch">
                      <cases conditionExpression="aql:element.eContainer().eContainer().availableBrands.producedGoods->exists(g|g.hasSubCategory=element)">
                        <subModelOperations xsi:type="properties:DialogModelOperation" titleExpression="Error">
                          <buttons labelExpression="Accept" default="true" closeDialogOnClick="true">
                            <initialOperation/>
                          </buttons>
                          <page name="Default Page" semanticCandidateExpression="var:self" groups="//@ownedViewpoints[name='Mall%20Viewpoint']/@ownedRepresentations[name='Mall%20Diagram']/@defaultLayer/@toolSections.2/@ownedTools[name='Delete%20Sub%20and%20Category']/@initialOperation/@firstModelOperations/@subModelOperations.0/@default/@subModelOperations.0/@cases.0/@subModelOperations.0/@groups.0"/>
                          <groups name="Default Group" labelExpression="Can't remove a subcategory while there are still goods referencing it, please change the subcategory of those goods first." semanticCandidateExpression="var:self"/>
                        </subModelOperations>
                      </cases>
                      <default>
                        <subModelOperations xsi:type="tool_1:ChangeContext" browseExpression="var:element">
                          <subModelOperations xsi:type="tool_1:RemoveElement"/>
                        </subModelOperations>
                      </default>
                    </subModelOperations>
                  </default>
                </subModelOperations>
              </firstModelOperations>
            </initialOperation>
          </ownedTools>
        </toolSections>
      </defaultLayer>
    </ownedRepresentations>
  </ownedViewpoints>
</description:Group>
